{% extends 'tracker_app/base.html' %}
{% load static %}

{% block title %}Dashboard - Finance Manager{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/dashboard.css' %}">
<!-- Add Google Fonts for premium typography -->
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<style>
    body {
        font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
        background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
    }
</style>
{% endblock %}

{% block content %}
<div class="dashboard-wrapper">
    <div class="container-fluid px-4 py-4">
        
        <!-- Welcome Header Section -->
        <div class="welcome-section mb-4" data-aos="fade-down">
            <div class="row align-items-center">
                <div class="col-lg-8 col-md-7">
                    <h1 class="dashboard-title mb-2">
                        Welcome back, <span class="gradient-text">{{ user.first_name|default:user.username }}</span>! ðŸ‘‹
                    </h1>
                    <p class="dashboard-subtitle">
                        <i class="fas fa-calendar-alt me-2"></i>{{ current_month }} â€¢ Here's your financial overview
                    </p>
                </div>
                <div class="col-lg-4 col-md-5 text-md-end mt-3 mt-md-0">
                    <div class="date-badge">
                        <i class="fas fa-clock me-2"></i>
                        <span id="currentTime"></span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Stats Cards - Updated with new classes -->
        <div class="row g-4 mb-4">
            <!-- Salary Card -->
            <div class="col-xl-3 col-lg-6 col-md-6">
                <div class="stat-card stat-card-primary" data-aos="fade-up">
                    <div class="stat-card-header">
                        <div class="stat-icon-wrapper bg-primary-light">
                            <i class="fas fa-wallet"></i>
                        </div>
                        <div class="stat-trend">
                            <i class="fas fa-arrow-up"></i>
                        </div>
                    </div>
                    <div class="stat-card-body">
                        <p class="stat-label">Monthly Salary</p>
                        <h2 class="stat-value">
                            {% if salary %}
                                â‚¹{{ salary.salary_amount|floatformat:2 }}
                            {% else %}
                                â‚¹0.00
                            {% endif %}
                        </h2>
                        <a href="{% url 'salary_management' %}" class="stat-action-btn">
                            <i class="fas fa-edit me-1"></i> Manage Salary
                        </a>
                    </div>
                </div>
            </div>

            <!-- Expenses Card -->
            <div class="col-xl-3 col-lg-6 col-md-6">
                <div class="stat-card stat-card-danger" data-aos="fade-up" data-aos-delay="100">
                    <div class="stat-card-header">
                        <div class="stat-icon-wrapper bg-danger-light">
                            <i class="fas fa-credit-card"></i>
                        </div>
                        <div class="stat-trend stat-trend-down">
                            <i class="fas fa-arrow-{% if metrics.expense_change > 0 %}up{% else %}down{% endif %}"></i>
                            <span>{{ metrics.expense_change|floatformat:1 }}%</span>
                        </div>
                    </div>
                    <div class="stat-card-body">
                        <p class="stat-label">Total Expenses</p>
                        <h2 class="stat-value">â‚¹{{ total_expenses|floatformat:2 }}</h2>
                        <a href="{% url 'expense_management' %}" class="stat-action-btn">
                            <i class="fas fa-eye me-1"></i> View Details
                        </a>
                    </div>
                </div>
            </div>

            <!-- Balance Card -->
            <div class="col-xl-3 col-lg-6 col-md-6">
                <div class="stat-card stat-card-success" data-aos="fade-up" data-aos-delay="200">
                    <div class="stat-card-header">
                        <div class="stat-icon-wrapper bg-success-light">
                            <i class="fas fa-piggy-bank"></i>
                        </div>
                        <div class="stat-trend">
                            {% if salary and salary.salary_amount > 0 %}
                                <span class="savings-badge">{{ remaining_balance|divisibleby:salary.salary_amount|floatformat:0 }}%</span>
                            {% endif %}
                        </div>
                    </div>
                    <div class="stat-card-body">
                        <p class="stat-label">Remaining Balance</p>
                        <h2 class="stat-value">â‚¹{{ remaining_balance|floatformat:2 }}</h2>
                        <a href="{% url 'ai_insights' %}" class="stat-action-btn">
                            <i class="fas fa-lightbulb me-1"></i> Invest Wisely
                        </a>
                    </div>
                </div>
            </div>

            <!-- Budget Card -->
            <div class="col-xl-3 col-lg-6 col-md-6">
                <div class="stat-card stat-card-warning" data-aos="fade-up" data-aos-delay="300">
                    <div class="stat-card-header">
                        <div class="stat-icon-wrapper bg-warning-light">
                            <i class="fas fa-chart-pie"></i>
                        </div>
                        <div class="stat-trend">
                            <span class="daily-avg">â‚¹{{ metrics.avg_daily_spending|floatformat:0 }}/day</span>
                        </div>
                    </div>
                    <div class="stat-card-body">
                        <p class="stat-label">Budget Adherence</p>
                        <h2 class="stat-value">
                            {% if metrics.budget_adherence > 0 %}
                                {{ metrics.budget_adherence|floatformat:1 }}%
                            {% else %}
                                N/A
                            {% endif %}
                        </h2>
                        <a href="{% url 'budget_management' %}" class="stat-action-btn">
                            <i class="fas fa-cog me-1"></i> Set Budget
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <!-- Budget Alerts & Recent Expenses -->
        <div class="row g-4 mb-4">
            <!-- Budget Alerts -->
            <div class="col-xl-6">
                <div class="content-card" data-aos="fade-right">
                    <div class="content-card-header">
                        <div>
                            <h5 class="content-card-title">
                                <i class="fas fa-bell me-2"></i>Budget Alerts
                            </h5>
                            <p class="content-card-subtitle">Monitor your spending limits</p>
                        </div>
                        <span class="alert-count-badge">{{ budget_alerts|length }}</span>
                    </div>
                    <div class="content-card-body">
                        {% if budget_alerts %}
                            <div class="budget-alerts-list">
                                {% for alert in budget_alerts %}
                                <div class="budget-alert-item">
                                    <div class="budget-alert-info">
                                        <div class="budget-category-icon" style="background: {{ alert.category.color|default:'#6366f1' }}20; color: {{ alert.category.color|default:'#6366f1' }}">
                                            <i class="fas fa-tag"></i>
                                        </div>
                                        <div class="budget-details">
                                            <h6 class="budget-category-name">{{ alert.category }}</h6>
                                            <p class="budget-amount-text">â‚¹{{ alert.used|floatformat:0 }} / â‚¹{{ alert.limit|floatformat:0 }}</p>
                                        </div>
                                    </div>
                                    <div class="budget-progress-wrapper">
                                        <div class="progress-bar-modern">
                                            <div class="progress-fill progress-fill-{{ alert.alert }}" style="width: {{ alert.percentage|floatformat:0 }}%"></div>
                                        </div>
                                        <span class="budget-percentage-badge badge-{{ alert.alert }}">{{ alert.percentage|floatformat:0 }}%</span>
                                    </div>
                                </div>
                                {% endfor %}
                            </div>
                        {% else %}
                            <div class="empty-state">
                                <div class="empty-state-icon">
                                    <i class="fas fa-chart-pie"></i>
                                </div>
                                <h6 class="empty-state-title">No Budget Alerts</h6>
                                <p class="empty-state-text">Create your first budget to track spending</p>
                                <a href="{% url 'budget_management' %}" class="btn-modern btn-primary">
                                    <i class="fas fa-plus-circle me-2"></i>Create Budget
                                </a>
                            </div>
                        {% endif %}
                    </div>
                </div>
            </div>

            <!-- Recent Expenses -->
            <div class="col-xl-6">
                <div class="content-card" data-aos="fade-left">
                    <div class="content-card-header">
                        <div>
                            <h5 class="content-card-title">
                                <i class="fas fa-history me-2"></i>Recent Expenses
                            </h5>
                            <p class="content-card-subtitle">Your latest transactions</p>
                        </div>
                        <a href="{% url 'add_expense' %}" class="btn-icon-modern">
                            <i class="fas fa-plus"></i>
                        </a>
                    </div>
                    <div class="content-card-body">
                        {% if recent_expenses %}
                            <div class="expense-list">
                                {% for expense in recent_expenses %}
                                <div class="expense-item">
                                    <div class="expense-icon-wrapper">
                                        <i class="fas fa-receipt"></i>
                                    </div>
                                    <div class="expense-details">
                                        <h6 class="expense-name">{{ expense.expense_name }}</h6>
                                        <p class="expense-meta">
                                            <span class="expense-date">{{ expense.expense_date|date:"d M Y" }}</span>
                                            {% if expense.description %}
                                            <span class="expense-divider">â€¢</span>
                                            <span class="expense-desc">{{ expense.description|truncatechars:25 }}</span>
                                            {% endif %}
                                        </p>
                                    </div>
                                    <div class="expense-amount-wrapper">
                                        <span class="expense-category-badge" style="background: {{ expense.expense_category.color|default:'#6366f1' }}20; color: {{ expense.expense_category.color|default:'#6366f1' }}">
                                            {{ expense.expense_category.name }}
                                        </span>
                                        <h6 class="expense-amount">-â‚¹{{ expense.expense_amount|floatformat:2 }}</h6>
                                    </div>
                                </div>
                                {% endfor %}
                            </div>
                            <div class="text-center mt-3">
                                <a href="{% url 'expense_management' %}" class="view-all-link">
                                    View All Expenses <i class="fas fa-arrow-right ms-1"></i>
                                </a>
                            </div>
                        {% else %}
                            <div class="empty-state">
                                <div class="empty-state-icon">
                                    <i class="fas fa-receipt"></i>
                                </div>
                                <h6 class="empty-state-title">No Expenses Yet</h6>
                                <p class="empty-state-text">Start tracking your expenses today</p>
                                <a href="{% url 'add_expense' %}" class="btn-modern btn-success">
                                    <i class="fas fa-plus-circle me-2"></i>Add Expense
                                </a>
                            </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>

        <!-- Quick Actions -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="content-card" data-aos="fade-up">
                    <div class="content-card-header">
                        <div>
                            <h5 class="content-card-title">
                                <i class="fas fa-bolt me-2"></i>Quick Actions
                            </h5>
                            <p class="content-card-subtitle">Manage your finances efficiently</p>
                        </div>
                    </div>
                    <div class="content-card-body">
                        <div class="row g-3">
                            <div class="col-lg-2 col-md-4 col-6">
                                <a href="{% url 'add_expense' %}" class="quick-action-card quick-action-danger">
                                    <div class="quick-action-icon">
                                        <i class="fas fa-plus-circle"></i>
                                    </div>
                                    <p class="quick-action-label">Add Expense</p>
                                </a>
                            </div>
                            <div class="col-lg-2 col-md-4 col-6">
                                <a href="{% url 'salary_management' %}" class="quick-action-card quick-action-primary">
                                    <div class="quick-action-icon">
                                        <i class="fas fa-edit"></i>
                                    </div>
                                    <p class="quick-action-label">Update Salary</p>
                                </a>
                            </div>
                            <div class="col-lg-2 col-md-4 col-6">
                                <a href="{% url 'ai_insights' %}" class="quick-action-card quick-action-success">
                                    <div class="quick-action-icon">
                                        <i class="fas fa-robot"></i>
                                    </div>
                                    <p class="quick-action-label">AI Insights</p>
                                </a>
                            </div>
                            <div class="col-lg-2 col-md-4 col-6">
                                <a href="{% url 'monthly_summary' %}" class="quick-action-card quick-action-info">
                                    <div class="quick-action-icon">
                                        <i class="fas fa-file-alt"></i>
                                    </div>
                                    <p class="quick-action-label">Reports</p>
                                </a>
                            </div>
                            <div class="col-lg-2 col-md-4 col-6">
                                <a href="{% url 'analytics' %}" class="quick-action-card quick-action-warning">
                                    <div class="quick-action-icon">
                                        <i class="fas fa-chart-line"></i>
                                    </div>
                                    <p class="quick-action-label">Analytics</p>
                                </a>
                            </div>
                            <div class="col-lg-2 col-md-4 col-6">
                                <a href="{% url 'budget_management' %}" class="quick-action-card quick-action-secondary">
                                    <div class="quick-action-icon">
                                        <i class="fas fa-cog"></i>
                                    </div>
                                    <p class="quick-action-label">Budget</p>
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Financial Health Summary -->
        <div class="row">
            <div class="col-12">
                <div class="content-card health-card" data-aos="fade-up">
                    <div class="content-card-header">
                        <div>
                            <h5 class="content-card-title">
                                <i class="fas fa-heartbeat me-2"></i>Financial Health
                            </h5>
                            <p class="content-card-subtitle">Track your financial wellness</p>
                        </div>
                    </div>
                    <div class="content-card-body">
                        <div class="row g-4">
                            <div class="col-lg-3 col-md-6">
                                <div class="health-metric">
                                    <div class="health-metric-icon health-icon-success">
                                        <i class="fas fa-percentage"></i>
                                    </div>
                                    <div class="health-metric-content">
                                        <p class="health-metric-label">Savings Rate</p>
                                        {% if salary and salary.salary_amount > 0 %}
                                            <h3 class="health-metric-value health-value-{% if remaining_balance|divisibleby:salary.salary_amount > 20 %}success{% elif remaining_balance|divisibleby:salary.salary_amount > 10 %}warning{% else %}danger{% endif %}">
                                                {{ remaining_balance|divisibleby:salary.salary_amount|floatformat:1 }}%
                                            </h3>
                                            <p class="health-metric-target">Target: 20%</p>
                                        {% else %}
                                            <h3 class="health-metric-value text-muted">N/A</h3>
                                            <p class="health-metric-target">Add salary</p>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-3 col-md-6">
                                <div class="health-metric">
                                    <div class="health-metric-icon health-icon-info">
                                        <i class="fas fa-calendar-day"></i>
                                    </div>
                                    <div class="health-metric-content">
                                        <p class="health-metric-label">Daily Average</p>
                                        <h3 class="health-metric-value">â‚¹{{ metrics.avg_daily_spending|floatformat:2 }}</h3>
                                        <p class="health-metric-target">Spending per day</p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-3 col-md-6">
                                <div class="health-metric">
                                    <div class="health-metric-icon health-icon-{% if metrics.expense_change > 0 %}danger{% else %}success{% endif %}">
                                        <i class="fas fa-exchange-alt"></i>
                                    </div>
                                    <div class="health-metric-content">
                                        <p class="health-metric-label">Month Change</p>
                                        <h3 class="health-metric-value health-value-{% if metrics.expense_change > 0 %}danger{% else %}success{% endif %}">
                                            {{ metrics.expense_change|floatformat:1 }}%
                                        </h3>
                                        <p class="health-metric-target">vs Last Month</p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-3 col-md-6">
                                <div class="health-metric">
                                    <div class="health-metric-icon health-icon-warning">
                                        <i class="fas fa-bullseye"></i>
                                    </div>
                                    <div class="health-metric-content">
                                        <p class="health-metric-label">Budget Health</p>
                                        <h3 class="health-metric-value health-value-{% if metrics.budget_adherence > 80 %}success{% elif metrics.budget_adherence > 60 %}warning{% else %}danger{% endif %}">
                                            {% if metrics.budget_adherence > 0 %}
                                                {{ metrics.budget_adherence|floatformat:0 }}%
                                            {% else %}
                                                N/A
                                            {% endif %}
                                        </h3>
                                        <p class="health-metric-target">Adherence Rate</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div>
</div>
{% endblock %}

{% block extra_js %}
<!-- Add AOS library for scroll animations -->
<link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
<script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
<script src="{% static 'js/dashboard.js' %}"></script>
<script>
    // Initialize AOS animations
    AOS.init({
        duration: 800,
        once: true,
        offset: 100
    });

    // Update current time
    function updateTime() {
        const now = new Date();
        const options = { 
            hour: '2-digit', 
            minute: '2-digit', 
            hour12: true,
            month: 'short',
            day: 'numeric'
        };
        const timeString = now.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit', hour12: true });
        const dateString = now.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
        document.getElementById('currentTime').textContent = `${dateString} â€¢ ${timeString}`;
    }
    updateTime();
    setInterval(updateTime, 60000);
</script>
{% endblock %}