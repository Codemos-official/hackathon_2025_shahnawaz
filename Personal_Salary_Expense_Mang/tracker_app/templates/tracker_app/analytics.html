{% extends 'tracker_app/base.html' %}
{% load static %}

{% block title %}Analytics - Finance Manager{% endblock %}

{% block content %}
<div class="container-fluid mt-4">

<div class="row mb-4">
    <div class="col-md-3">
        <div class="card shadow-sm">
            <div class="card-body">
                <h6 class="text-muted">Total Spent (6 Months)</h6>
                <h3 class="text-danger">₹{{ total_expenses_6m|floatformat:2 }}</h3>
            </div>
        </div>
    </div>

    <div class="col-md-3">
        <div class="card shadow-sm">
            <div class="card-body">
                <h6 class="text-muted">Avg Monthly Expense</h6>
                <h3 class="text-warning">₹{{ avg_monthly_expense|floatformat:2 }}</h3>
            </div>
        </div>
    </div>

    <div class="col-md-3">
        <div class="card shadow-sm">
            <div class="card-body">
                <h6 class="text-muted">Savings Rate</h6>
                <h3 class="text-success">{{ savings_rate }}%</h3>
            </div>
        </div>
    </div>

    <div class="col-md-3">
        <div class="card shadow-sm">
            <div class="card-body">
                <h6 class="text-muted">Top Category</h6>
                <h5>
                    {% if category_data %}
                        {{ category_data.0.name }}
                    {% else %}
                        N/A
                    {% endif %}
                </h5>
            </div>
        </div>
    </div>
</div>

<!-- Monthly Table -->
<div class="card shadow-sm">
    <div class="card-header bg-primary text-white">
        Monthly Analysis
    </div>
    <div class="card-body">
        <table class="table table-hover">
            <thead>
                <tr>
                    <th>Month</th>
                    <th>Salary</th>
                    <th>Expenses</th>
                    <th>Savings</th>
                    <th>Savings %</th>
                    <th>Status</th>
                </tr>
            </thead>
            <tbody>
                {% for data in monthly_data %}
                <tr>
                    <td>{{ data.month }}</td>
                    <td class="text-success">₹{{ data.salary|floatformat:2 }}</td>
                    <td class="text-danger">₹{{ data.expenses|floatformat:2 }}</td>
                    <td class="{% if data.savings >= 0 %}text-success{% else %}text-danger{% endif %}">
                        ₹{{ data.savings|floatformat:2 }}
                    </td>
                    <td>
                        {% if data.savings_percent is not None %}
                        <span class="badge 
                        {% if data.savings_percent >= 20 %}bg-success
                        {% elif data.savings_percent >= 10 %}bg-warning
                        {% else %}bg-danger{% endif %}">
                            {{ data.savings_percent }}%
                        </span>
                        {% else %}
                        <span class="badge bg-secondary">N/A</span>
                        {% endif %}
                    </td>
                    <td>
                        {% if data.savings >= 0 %}
                        <span class="badge bg-success">Good</span>
                        {% else %}
                        <span class="badge bg-danger">Overspent</span>
                        {% endif %}
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="6" class="text-center text-muted">
                        No analytics data available
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

</div>
{% endblock %}
